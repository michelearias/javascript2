<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Curso de Javascript - Aula 51 (Jogo da Velha)</title>
    <style>
        #dvjogo{
            width: 160px;
            height: 160px;
            display: flex;
            flex-wrap: wrap; /*passa para baixo quando o tamanho for maior */
            align-content: flex-start; /*fazer o alinhamento do inicio */
        }

        .posJogo{
            width: 50px;
            height: 50px;
            margin: 0px;
            padding: 0px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 40px;
        }

        #p1{
            border-right: 1px solid #000;
            border-bottom: 1px solid #000;
        }

        #p2{
            border-left: 1px solid #000;
            border-right: 1px solid #000;
            border-bottom: 1px solid #000;
        }

        #p3{
            border-left: 1px solid #000;
            border-bottom: 1px solid #000;
        }

        #p4{
            border-right: 1px solid #000;
            border-top: 1px solid #000;
            border-bottom: 1px solid #000;
        }

        #p5{
            border: 1px solid #000;
        }

        #p6{
            border-left: 1px solid #000;
            border-top: 1px solid #000;
            border-bottom: 1px solid #000;
        }

        #p7{
            border-right: 1px solid #000;
            border-top: 1px solid #000;
        }

        #p8{
            border-left: 1px solid #000;
            border-right: 1px solid #000;
            border-top: 1px solid #000;
        }

        #p9{
            border-left: 1px solid #000;
            border-top: 1px solid #000;
        }
    </style>
    <script>

        var jogo=[] // recebe o controle do jogo, guarda as posições do jogo e as vazias
        var tabuleiro=[] // tem o controle dos elementos visuais 
        var quemJoga=0 // indica qual o jogador, sendo 0=jogador e 1=cpu
        var verifica // armazenar o resultado de uma função que verifica se houve vencedor ou não
        var jogando=true // indica se o jogo esta acontecendo ou não
        var nivel=1 //indica o nivel de dificuldade do jogo
        var jogadaCpu=1 // indicar inicialmente qual a jogada da cpu
        var quemComeca=1 // indica quem começa o jogo 

        function cpuJoga(){
            if(jogando){
                let l,c
                if(nivel===1){
                    do{//primeiro sortear as posições e depois verificar se as jogadas são validas
                        l=Math.round(Math.random()*2)
                        c=Math.round(Math.random()*2)
                    }while(jogo[l][c]!=='')
                    jogo[l][c]='O'
                }else if(nivel===2){
                    //NIVEL 2
                }
                verifica=verificaVitoria()
                console.log("[CpuJoga] Verifica resultado: ", verifica)
                if(verifica!==''){
                    alert(verifica+' venceu')
                    jogando=false //parar o jogo
                }
                atualizaTabuleiro()
                quemJoga=0
            }
        }

        function imprimirMatriz() {
            for(let l=0; l<3; l++) {
                for(let c=0; c<3; c++) {
                    console.log("linha: " + l + ", coluna: " + c + ". Valor: " + jogo[l][c])
                }
            }
        }
        
        function verificaVitoria(){
            let l,c
            //LINHAS
            imprimirMatriz()
            for(l=0; l<3; l++){
                if((jogo[l][0]==jogo[l][1])&&(jogo[l][1]==jogo[l][2])){
                    return jogo[l][0]
                }
            }
            //COLUNAS
            for(c=0; c<3; c++){
                if((jogo[0][c]==jogo[1][c])&&(jogo[1][c]==jogo[2][c])){
                    return jogo[0][c]
                }
            }

            //DIAGONAIS
            if((jogo[0][0]==jogo[1][1])&&(jogo[1][1]==jogo[2][2])){
                return jogo[0][0]
            }
            if((jogo[0][2]==jogo[1][1])&&(jogo[1][1]==jogo[2][0])){
                return jogo[0][2]
            }
            return ''
        }

        function jogar(p){ //passar como parametro uma posição
            if((jogando)&&(quemJoga===0)){ // se o jogo esta rolando e quem joga é o jogador
                switch(p){
                    case 1:
                        if(jogo[0][0]===''){
                            jogo[0][0]='X'
                            quemJoga=1
                        }
                    break
                    case 2:
                        if(jogo[0][1]===''){
                            jogo[0][1]='X'
                            quemJoga=1
                        }
                    break
                    case 3:
                        if(jogo[0][2]===''){
                            jogo[0][2]='X'
                            quemJoga=1
                        }
                    break
                    case 4:
                        if(jogo[1][0]===''){
                            jogo[1][0]='X'
                            quemJoga=1
                        }
                    break
                    case 5:
                        if(jogo[1][1]===''){
                            jogo[1][1]='X'
                            quemJoga=1
                        }
                    break
                    case 6:
                        if(jogo[1][2]===''){
                            jogo[1][2]='X'
                            quemJoga=1
                        }
                    break
                    case 7:
                        if(jogo[2][0]===''){
                            jogo[2][0]='X'
                            quemJoga=1
                        }
                    break
                    case 8:
                        if(jogo[2][1]===''){
                            jogo[2][1]='X'
                            quemJoga=1
                        }
                    break
                    default:
                        if(jogo[2][2]===''){
                            jogo[2][2]='X'
                            quemJoga=1
                        }
                }
                if(quemJoga===1){ // verificar se a jogada foi válida
                    atualizaTabuleiro()
                    verifica=verificaVitoria()
                    console.log("[Jogar] Verifica resultado: ", verifica)
                    if(verifica!==''){
                        alert(verifica +' venceu')
                        jogando=false
                    }
                    cpuJoga() // chama a cpu para jogar
                }
            }
        }

        function atualizaTabuleiro(){
            for(let l=0;l<3;l++){ // um for para percorrer as linhas e outro for para percorrer as colunas
                for(let c=0;c<3;c++){
                    tabuleiro[l][c].style.cursor='default'
                    if(jogo[l][c]==='X'){
                        tabuleiro[l][c].innerHTML='X'
                    }else if(jogo[l][c]==='O'){
                        tabuleiro[l][c].innerHTML='O'
                    }else{
                        tabuleiro[l][c].innerHTML=''
                        tabuleiro[l][c].style.cursor='pointer'
                    }
                }
            }
        }

        function inicia(){
            console.log("Iniciou")
            jogando=true
            jogadaCpu=1
            jogo=[
                ['','',''],
                ['','',''],
                ['','','']
        ]
        tabuleiro=[
            [document.getElementById('p1'),document.getElementById('p2'),document.getElementById('p3')],
            [document.getElementById('p4'),document.getElementById('p5'),document.getElementById('p6')],
            [document.getElementById('p7'),document.getElementById('p8'),document.getElementById('p9')]
        ]
        atualizaTabuleiro() // zerar todas as opçoes do tabuleiro
        if(quemComeca===1){
            quemComeca=0
            quemJoga=quemComeca
            document.getElementById('dvQuemComeca').innerHTML='Quem começa: Jogador'
        }else{
            quemComeca=1
            quemJoga=quemComeca
            document.getElementById('dvQuemComeca').innerHTML='Quem começa: CPU'
            cpuJoga()
        }
    }

        window.addEventListener('load',inicia)

    </script>
</head>
<body>
    <div id="dvmenu">
        <div id="dvQuemComeca">Quem joga:</div>
        <button onclick="inicia()">Iniciar Jogo</button>
    </div>
    <div id="dvjogo">
        <div id="p1" class="posJogo" onclick="jogar(1)"></div>
        <div id="p2" class="posJogo" onclick="jogar(2)"></div>
        <div id="p3" class="posJogo" onclick="jogar(3)"></div>
        <div id="p4" class="posJogo" onclick="jogar(4)"></div>
        <div id="p5" class="posJogo" onclick="jogar(5)"></div>
        <div id="p6" class="posJogo" onclick="jogar(6)"></div>
        <div id="p7" class="posJogo" onclick="jogar(7)"></div>
        <div id="p8" class="posJogo" onclick="jogar(8)"></div>
        <div id="p9" class="posJogo" onclick="jogar(9)"></div>
    </div>
    
</body>
</html>